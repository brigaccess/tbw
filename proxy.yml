---
- name: Prepare local CA
  hosts: 127.0.0.1
  connection: local
  roles:
    - local-ca
  vars:
    ca_passphrase: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        62333065343465323064346236346137323834326639323330303735326237613132623363353538
        3463363966626332613935333634633161626166643065380a633762303061383566353062396436
        31656136643264353164313064353637323335376666373361383637316333306433383632633337
        6462636663616366660a656539383563376161356132653434623131363836393035623333336432
        61326530386633346338623263393937623034336261636362316164333034633866323930356636
        3738306339373662666633396639396239636237356465626337
    ca_common_name: TBW CA

- name: Prepare hosts
  gather_facts: no  # Will do this later
  vars:
    ca_passphrase: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        62333065343465323064346236346137323834326639323330303735326237613132623363353538
        3463363966626332613935333634633161626166643065380a633762303061383566353062396436
        31656136643264353164313064353637323335376666373361383637316333306433383632633337
        6462636663616366660a656539383563376161356132653434623131363836393035623333336432
        61326530386633346338623263393937623034336261636362316164333034633866323930356636
        3738306339373662666633396639396239636237356465626337

  hosts: proxies
  remote_user: root
  roles:
    - basic-server  # Can be omitted if you've already preconfigured the server
    - local-ca-child  # Don't omit unless you want to handle all the certificates yourself

    # ----- comment out any of the following roles if you don't want components to be installed -----
    
    # When local-ca-child is commented out and you don't provide the certificates, 
    # this will generate self-signed certificates
    - softether-vpn

    - shadowsocks
    - shadowsocks-v2ray # Needs local-ca-child when configured with TLS
